<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gas Bill Calculator & Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="header-bar">
        <h1>Gas Tracker</h1>
        <div class="controls">
            <button class="secondary btn-sm" onclick="document.getElementById('settingsPanel').classList.toggle('hidden')">Settings</button>
            <button class="secondary btn-sm" onclick="app.resetData()">Reset</button>
        </div>
    </div>

    <!-- Settings Panel (Hidden by default) -->
    <div id="settingsPanel" class="settings-panel hidden">
        <div class="settings-row">
            <div class="settings-group">
                <div><label>Price/kWh (€)</label><input type="number" id="cfgPrice" step="0.000001" placeholder="0.12"></div>
                <div><label>Fixed/Day (€)</label><input type="number" id="cfgFixed" step="0.00001" placeholder="0.5"></div>
                <div><label>Postcode</label><input type="text" id="cfgPostcode" placeholder="28001"></div>
            </div>
            <div class="settings-actions">
                <button onclick="app.fetchWeather()">Fetch Weather</button>
                <button class="primary" onclick="app.updateSettings()">Save Settings</button>
                <button class="secondary" onclick="app.exportData()">Export Data</button>
                <button class="secondary" onclick="document.getElementById('fileInput').click()">Import Data</button>
                <input type="file" id="fileInput" style="display:none" onchange="app.importData(this)">
            </div>
        </div>
    </div>

    <!-- Main Dashboard Grid -->
    <div class="dashboard-grid">
        
        <!-- Left Column: Input & Data -->
        <div class="col-left">
            <!-- Add Reading -->
            <div class="card compact-card">
                <h2>Add Reading</h2>
                <div class="flex gap-1">
                    <div class="grow"><input type="datetime-local" id="inpDate"></div>
                    <div style="width: 100px;"><input type="number" id="inpReading" step="0.001" placeholder="m³"></div>
                    <button onclick="app.addReading()" style="width: auto;">+</button>
                </div>
            </div>

            <!-- Analysis Stats -->
            <div class="card compact-card">
                <h2>Analysis</h2>
                <div id="analysisPanel" class="stats-compact hidden">
                    <div><div class="stat-label">Days</div><div class="stat-value" id="outDays">-</div></div>
                    <div><div class="stat-label">Usage</div><div class="stat-value" id="outUsage">-</div></div>
                    <div><div class="stat-label">Cost</div><div class="stat-value" id="outCost">-</div></div>
                    <div><div class="stat-label">Proj.</div><div class="stat-value highlight-green" id="outProj">-</div></div>
                </div>
                <p class="text-muted text-sm" id="analysisPlaceholder">Select 2 readings to analyze.</p>
            </div>

            <!-- Data Table -->
            <div class="card grow">
                <div class="table-wrapper" style="max-height: 500px;">
                    <table id="dataTable">
                        <thead>
                            <tr>
                                <th>Sel</th>
                                <th>Date</th>
                                <th>Reading</th>
                                <th>Diff</th>
                                <th>Cost</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Right Column: Visualizations -->
        <div class="col-right">
            <div class="card">
                <h2>Readings Timeline</h2>
                <div class="chart-box h-200"><canvas id="chartReadings"></canvas></div>
            </div>
            <div class="card">
                <h2>Projection Evolution</h2>
                <div class="chart-box h-200"><canvas id="chartProjection"></canvas></div>
            </div>
            <div class="grid grid-2">
                <div class="card">
                    <h2>Daily Usage & Cost</h2>
                    <div class="chart-box h-200"><canvas id="chartDaily"></canvas></div>
                </div>
                <div class="card">
                    <h2>Cumulative Cost</h2>
                    <div class="chart-box h-200"><canvas id="chartCumulative"></canvas></div>
                </div>
                <div class="card">
                    <h2>Cost Breakdown</h2>
                    <div class="chart-box h-200"><canvas id="chartBreakdown"></canvas></div>
                </div>
                <div class="card">
                    <h2>Weather vs Usage</h2>
                    <div class="chart-box h-200"><canvas id="chartWeather"></canvas></div>
                </div>
                <div class="card">
                    <h2>Efficiency Correlation</h2>
                    <div class="chart-box h-200"><canvas id="chartScatter"></canvas></div>
                </div>
                <div class="card">
                    <h2>Heating Efficiency</h2>
                    <div class="chart-box h-200"><canvas id="chartEfficiency"></canvas></div>
                </div>
                <div class="card">
                    <h2>Smart 7-Day Forecast</h2>
                    <p class="text-muted text-sm mb-05">Predicts cost based on usage habits & weather forecast.</p>
                    <div class="stats-compact mb-05">
                        <div><div class="stat-label">Temp</div><div class="stat-value" id="fcTemp">-</div></div>
                        <div><div class="stat-label">Usage</div><div class="stat-value" id="fcUsage">-</div></div>
                        <div><div class="stat-label">Cost</div><div class="stat-value highlight-orange" id="fcCost">-</div></div>
                        <div><div class="stat-label">Conf.</div><div class="stat-value" id="fcConf">-</div></div>
                    </div>
                    <div class="chart-box h-200"><canvas id="chartForecast"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
